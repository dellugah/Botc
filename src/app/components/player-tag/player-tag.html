<div class="round_info">
  <img class="background_flag" src="/{{roundCycle}}.png" alt="">
  <img class="top_flag" src="/topFlag.png" alt="">
  <img class="bottom_flag" src="{{opposite}}" alt="" (click)="cycleDay()">
  <h1>Round</h1>
  <h1>{{roundCounter + 1}}</h1>
</div>
<div class="player_list">
  @for( player of players.playerList; track player.playerName){
    <div class="player_tag">
      <div class="player_cont">
        <div class="player_profile">
          <img class="player_class_pic" src="{{player.playerRole.roleImage.toLowerCase()}}" alt="class_icon" (click)="blockOrKillPlayer(player)">
          @if(player.isDead){
            @if(player.wasExecuted){
              <img class="death_token active" src="/executed_token.png" alt="dead" (click)="resurrectPlayer(player)">
            } @else {
              <img class="death_token active" src="/death_token.png" alt="dead" (click)="resurrectPlayer(player)">
            }
          }
          @else{
            <img class="death_token" src="/death_token.png" alt="dead">
          }
          <div class="player_info">
            <h2 class="player_class"><span class="{{player.playerAlignment}}">{{player.playerRole.roleName.toUpperCase()}}</span></h2>
            <div class="player_status">
              @if(player.playerRole.roleName != player.registeredAs.roleName){
                <img src="{{player.registeredAs.roleImage.toLowerCase()}}" alt="" width="auto" height="200%">
              }
            </div>
            <h2 class="player_name">{{player.playerName}}</h2>
          </div>
        </div>
        <div class="player_ability">
          @if (isDay) {
            @if (executeMode) {
              @if(!player.isDead){
                <div class="nomination">
                  <div class="token_container">
                    <img class="left_base" src="/nomination_base.png" alt="" (click)="nominatedPlayer(player)">
                  </div>
                  @if(player.canNominate){
                    <div class="token_container">
                      <img class="left_base token"
                           src="/nomination_token.png" alt=""
                           (click)="nominatedPlayer(player)">
                    </div>
                  }
                  <img class="right_base" src="/nominated_base.png" alt="" (click)="wasNominated(player)">
                  @if(!player.wasIndicated){
                    <img class="right_base  token"
                         src="/nominated_token.png" alt=""
                         (click)="wasNominated(player)">
                  }
                </div>
              } @else{
                <div class="nomination">
                  <div class="token_container">
                    <img class="center_base" src="/ghost_vote_base.png" alt="" (click)="spendDeadVote(player)">
                    @if(player.hasDeadVote){
                      <img class="center_base center_token"
                           src="/ghost_vote_token.png" alt=""
                           (click)="spendDeadVote(player)">
                    }
                  </div>
                </div>
              }
            } @else {
              @if([Roles.VIRGIN, Roles.SLAYER].includes(player.playerRole.roleName)){
                <div class="token_container">
                  <img class="center_base" src="/ability_base.png" alt="" (click)="spendAbility(player)">
                  @if(player.hasAbility && !player.isDead){
                    <img class="center_base token_image" src="{{player.playerRole.roleImage.toLowerCase()}}" alt="" width="auto" height="200%">
                    <img class="center_base center_token"
                         src="/ability_token.png" alt=""
                         (click)="spendAbility(player)">

                  }
                </div>
              }
            }
          } @else{
            @if(player.hasAbility && !player.isDead){
              <img class="ability_button" src="/use_ability.png" (click)="abilityMode = true">
            }
          }
        </div>
        <div class="player_conditions">
          @if(player.isDrunk){
            <img class="condition" src="/drunk.webp" alt="Is the Drunk">
          }
          @if(player.isProtected && !isDay){
            <img class="condition" src="/monk.webp" alt="protected">
          }
          @if(player.isPoisoned){
            <img class="condition" src="/poisoner.webp" alt="poisoned">
          }
          @if(player.isRedHearing){
            <img class="condition" src="/fortuneteller.webp" alt="Red Hearing">
          }
          @if(player.isMarkedForDeath){
            <img class="condition" src="/imp.webp" alt="Marked for Death">
          }
        </div>
      </div>
      <img class="slide_options" src="/edit_player_tag.png" alt="" (click)="toggleOptions(player)">
      <div class="player_options" [class.open]="openedPlayer === player">
        @if (player.playerRole.roleName != Roles.NONE) {
          <button class="option_button"><h2>About this role</h2></button>
        }
        <button class="option_button" (click)="this.edit.player = player"><h2>Change Role</h2></button>
        <button class="option_button" (click)="player.changeAlignment()"><h2>Change Alignment </h2></button>
        <button class="option_button" (click)="this.comment.player = player"><h2>Comments</h2></button>
      </div>
    </div>
  }
  <div id="ghost_tag"></div>
</div>
<div class="classes_info">
  <img class="top_flag" src="/topFlag.png" alt="">
  @if(isDay){
    @if(!executeMode){
      <h1>Talk</h1>
      <img class="background_flag" src="/talk_round.png" alt="">
      <img class="bottom_flag" src="/guillotineFlag.png" alt="" (click)="changeMode()">
    } @else {
      <h1>Block</h1>
      <div class="highlight-player">
        <img src="{{blockPlayer.playerRole.toLowerCase()}}" alt=""
             width="90%" height="auto"
             (click)="resetBlock()">
        <span class="stroke"><h1>{{blockPlayer.playerName}}</h1></span>
      </div>
      <img class="background_flag" src="/guillotine_round.png" alt="">
      <img class="bottom_flag" src="/talkFlag.png" alt="" (click)="changeMode()">
    }
  } @else{
    <h1>Wake</h1>
    <div class="highlight-player">
      <img src="{{wakePlayer.playerRole.toLowerCase()}}" alt="" width="90%" height="auto">
      <span class="stroke"><h1>{{wakePlayer.playerName}}</h1></span>
    </div>
    <img class="background_flag" src="/wake_order.png" alt="">
    <img class="bottom_flag" src="/wakeFlag.png" alt="" (click)="wakePlayerSequence()">
  }
</div>

<img class="right_option" src="/side_options.png" alt="">
<img class="right_option symbol_right" src="/next-button.png" alt="" (click)="nextRound()">

<img class="left_option" src="/side_options.png" alt="">
<img class="left_option symbol_left" src="/next-button.png" alt="" (click)="rollbackRound()">

@if(this.edit.player != null){
  <div id="screen_block" (click)="this.edit.player = null"></div>
  <app-role-selection id="role_select"></app-role-selection>
}

@if(this.comment.player != null){
  <div id="screen_block" (click)="this.comment.player = null"></div>
  <app-comment-board id="comments_section"></app-comment-board>
}

@if(abilityMode){
  <app-ability-page id="ability_page"></app-ability-page>
  <div id="screen_block" (click)="abilityMode = false"></div>
}
